model Flashcard {
  id               String   @id @default(cuid())
  userId           String?  @default("default")
  documentId       String
  front            String
  back             String
  context          String?
  chunkId          String?
  sourceQuestionId String?
  isVocabulary     Boolean  @default(false)
  exampleSentence  String?
  partOfSpeech     String?
  conjugation      Json?
  createdAt        DateTime @default(now())

  document       Document       @relation(fields: [documentId], references: [id], onDelete: Cascade)
  chunk          DocumentChunk? @relation(fields: [chunkId], references: [id])
  sourceQuestion QuizQuestion?  @relation(fields: [sourceQuestionId], references: [id], onDelete: SetNull)
  progress       FlashcardProgress?
  reviewLogs     ReviewLog[]

  @@index([userId])
}

model FlashcardProgress {
  id             String    @id @default(cuid())
  flashcardId    String    @unique

  // FSRS fields
  stability      Float     @default(0)
  difficulty     Float     @default(0)
  elapsedDays    Int       @default(0)
  scheduledDays  Int       @default(0)
  reps           Int       @default(0)
  lapses         Int       @default(0)
  state          Int       @default(0)
  due            DateTime  @default(now())
  lastReview     DateTime?

  // Legacy SM-2 (kept for transition)
  easeFactor     Float     @default(2.5)
  interval       Int       @default(1)
  repetitions    Int       @default(0)
  nextReviewAt   DateTime
  lastReviewedAt DateTime?

  flashcard Flashcard @relation(fields: [flashcardId], references: [id], onDelete: Cascade)

  @@index([due])
  @@index([nextReviewAt])
}

model ReviewLog {
  id            String   @id @default(cuid())
  flashcardId   String
  rating        Int
  state         Int
  stability     Float
  difficulty    Float
  elapsedDays   Int
  scheduledDays Int
  reviewedAt    DateTime @default(now())

  flashcard Flashcard @relation(fields: [flashcardId], references: [id], onDelete: Cascade)

  @@index([flashcardId])
  @@index([reviewedAt])
}
